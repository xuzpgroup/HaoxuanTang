import json
from zhipuai import ZhipuAI
import copy

client = ZhipuAI(api_key="")

docpath = ''
with open(docpath + '1.json', 'r', encoding='utf-8') as f:
    doc_dict = json.load(f)


data = []
dois=list(doc_dict.keys())
# Sample text and output structure
text1 = "2.1 Materials Preparation The equiatomic CoCrNi MEA was prepared by arc-melting high-purity raw materials (i.e., the purities of Co, Cr, and Ni are more than 99.95 wt%) under argon atmosphere. The ingot was remelted at least six times with electromagnetic stirring simultaneously to ensure the homogeneity, and then cast into a copper mold with a dimension of 75 mm × 15 mm × 5 mm, following by cold rolling progressively along the length direction to reduce the ingot to a thickness of 1.5 mm (a total reduction of ~70%). The surface of cold-rolled sheet was crack-free. The sheet was annealed at 600 °C for 1 h and quenched into water immediately. 2.2 Nano Indentation and Cryogenic Tensile Tests Nano-indentation tests were performed by the nano-indenter system (Hysitron TI980) with a diamond Berkovich indenter. Further details are available in a previous study [29]. Before testing, the surfaces of samples were polished to scratchfree. The load was set as 10 mN at a constant loading rate of 2 mN/s, then maintained at maximum load for 2 s, the following unloaded process was completed at a rate of 2 mN/s. A array in the form of 3 × 3 indentations with the interspacing of 20 μm were conducted. Dog-bone-shaped tensile specimens with a gauge of 12.5 × 3.2 × 1.5 mm (length, width and thickness) were fabricated by an electrical discharge machining. The longitudinal axis of these specimens should be consistent with the rolling direction of sheet. Prior to tensile testing, the faces and sides of all specimens were polished to guarantee surface regularities. The quasi-static uniaxial tensile tests were conducted on the tensile instrument (Instron 5982) equipped with an extensometer at a constant strain rate of 1 × 10–3 s-1. The testing temperature of 0 °C and –120 °C were fixed in the cryogenic chamber by filling with liquid nitrogen. 2.3 Cryogenic Dry Sliding Tests Cryogenic dry sliding tests were conducted on the multifunctional tribometer (Rtec MFT-5000) in cryogenic chamber cooling by liquid nitrogen as illustrated in Fig. 1. Ball-on-disk contact model against a hardened GCr15 steel ball under a normal load of 10 N was adopted. The rotation radius, rotation frequency, and sliding time were fixed as 1.5 mm, 60 rpm, and 20 min, respectively. The tests were carried out at four different cryogenic temperatures (0 °C, –40 °C, –80 °C and –120 °C). Before the sliding tests, the surfaces of specimens were ground with 500, 1000, 2000 grit SiC sandpapers in sequence and mechanical polished to ensure smooth surface and consistent roughness. The coefficient of friction (COF) was recorded directly during sliding tests. Repeated evaluation with three times was performed on each condition to ensure the accuracy. The morphologies of worn surface and the wear losses were measured by 3D profiler (Bruker Contour GT-K1) based on the white light interference technique to determine the wear rate after sliding tests. 2.4 Microstructural Characterization The phases of the specimen were identified by X-ray diffraction (XRD, Bruker D8) using a monochromatic Cu Kα radiation (λ = 1.5406 Å) at 40 kV with the 2θ range from 40° to 100°. The initial microstructural features, worn surface morphology, and cross-sectional worn subsurface after sliding tests were measured by scanning electron microscope (SEM, FEI Helios G4 CX). Additional elemental distributions were detected by energy dispersive spectrometer (EDS). The crystallographic features were analyzed by an electron backscattered scattering diffraction (EBSD) system. Electronic polishing with an electrolyte (i.e., the solution of 5% volume perchloric acid and 95% volume alcohol) at voltage of 45 V for 20 s was performed before EBSD characterization. 3.2 Cryogenic Tensile Behaviors The engineering stress–strain curves of the heterogeneous CoCrNi MEA is shown in Fig. 7a. Both Test temperature (0 °C and –120 °C) were selected as representatives for comparison to explore the cryogenic effect. The alloy shows a superb combination of strength and ductility at cryogenic temperature. As shown in Table 3, the yield strength (σy), ultimate strength (σu), and total elongation (εte) of heterogeneous MEA are ~ 1108 MPa, ~ 1140 MPa and ~ 24% at 0 °C and ~ 1258 MPa, ~ 1324 MPa and ~ 28% at –120 °C, showing a simultaneously improvement with decreasing the temperature down to –120 °C. In addition, true stress and the "
text2 = "2 Materials and Methods2.1 Experimental MethodsPhase equilibrium thermodynamic modeling was employedto design a 40Fe–25Ni–15Cr–10Co–10V HEA with a singleFCC phase over a wide range of temperature. The thermodynamic database TCFE2000 and its upgraded version [15,16] were used for phase diagram calculations [17, 18]. Thedesigned alloy was fabricated using vacuum induction meltingof pure elements (purity 99% or more). The ingot was homogenized in an argon atmosphere at 1100 °C for 6 h, followedby water quenching. The initial thickness of the homogenizedslab was 8 mm, and it was cold rolled to a final thickness of~1.5 mm (~80% thickness reduction). The rolled plate wasannealed at 900 °C for 10 min in an argon atmosphere, followed by water quenching. The secondary processing of ascast alloy is schematically illustrated in Fig. 1.Rectangular dog-bone shaped tensile specimens were madewith the loading direction parallel to the rolling direction.The tensile tests were carried out using an electromechanicaltesting machine (Instron 1361, USA) at room and 77K and at a constant strain rate of 10-3 s-1. Vickershardness measurements were conducted at a regular spatialinterval from the middle to the edge of the gage (HM-220,MITUTOYO, Japan).The X-ray diffraction (XRD) analysis was performed toidentify the crystal structure of the designed alloy. The surface perpendicular to the normal direction of the specimenwas mechanically polished with silicon carbide papers of 400,600, 800, and 1200 grit, followed by diamond suspensions of3, 1, and 0.5 µm. Final polishing was done with a mixture of50% ethanol and 50% colloidal silica to obtain a mirror-likesurface. The polished specimens were checked for twin formation using electron backscatter diffraction (EBSD) analysis.The EBSD data was analyzed using the commercial software(TSL OIM Analysis 7).The finite element method (FEM) associated with a constitutive model (based on a model reflecting twinning-inducedplasticity) was utilized to simulate the plastic deformationbehavior of the alloy. In order to use FEM, a user subroutineUMAT in the commercial program ABAQUS was constructedand implemented."
str1 = '[ { "doi": "10.1007/s11249-022-01643-x", "mech_prop": { "temperature": 273, "yield_strength": 1108, "ultimate_strength": 1140, "elongation": 24,"impact energy":null }, "materials": { "mat_name": "CoCrNi", "mat_type": "MEA", "composition": [], "ratio_type": "" }, "processing": { "proc_para": [ { "type": "arc-melting", "environment": "argon atmosphere" }, { "type": "re-melting", "method": "electromagnetic stirring" }, { "type": "casting" }, { "type": "cold rolling", "reduction unit": "%", "reduction value": [ 70.0 ] }, { "type": "annealing", "temperature": { "value": [ 600 ], "unit": "°C" }, "time": { "value": [ 1 ], "unit": "h" } }, { "type": "water quenching" } ], "surf_para": [ { "type": "polishing" }, { "type": "EDM" } ], "ingot_desc": "rectangular", "ingot_size": [ 75, 15, 5 ] }, "testing": { "test_type": "tensile", "test_tem": [ 273 ], "test_env": "liquid nitrogen", "refrigerant": "liquid nitrogen", "test_mac": "Instron 5982", "test_standard": "", "load_ctrl": "strain", "rate": [ { "value": [ 0.001 ], "unit": "s-1" } ], "spec_desc": "Dog-bone-shaped", "spec_shape": "rectangular", "spec_size": [ 12.5, 3.2, 1.5 ], "spec_standard": "", "spec_dir": "longitudinal axis consistent with the rolling direction of sheet","spec_notch":"" } }, { "doi": "10.1007/s11249-022-01643-x", "mech_prop": { "temperature": 153, "yield_strength": 1258, "ultimate_strength": 1324, "elongation": 28,"impact energy":null }, "materials": { "mat_name": "CoCrNi", "mat_type": "MEA", "composition": [], "ratio_type": "" }, "processing": { "proc_para": [ { "type": "arc-melting", "environment": "argon atmosphere" }, { "type": "re-melting", "method": "electromagnetic stirring" }, { "type": "casting" }, { "type": "cold rolling", "reduction unit": "%", "reduction value": [ 70.0 ] }, { "type": "annealing", "temperature": { "value": [ 600 ], "unit": "°C" }, "time": { "value": [ 1 ], "unit": "h" } }, { "type": "water quenching" } ], "surf_para": [ { "type": "polishing" }, { "type": "EDM" } ], "ingot_desc": "rectangular", "ingot_size": [ 75, 15, 5 ] }, "testing": { "test_type": "tensile", "test_tem": [ 153 ], "test_env": "liquid nitrogen", "refrigerant": "liquid nitrogen", "test_mac": "Instron 5982", "test_standard": "", "load_ctrl": "strain", "rate": [ { "value": [ 0.001 ], "unit": "s-1" } ], "spec_desc": "Dog-bone-shaped", "spec_shape": "rectangular", "spec_size": [ 12.5, 3.2, 1.5 ], "spec_standard": "", "spec_dir": "longitudinal axis consistent with the rolling direction of sheet","spec_notch":"" } } ]  '
str2 = '[{"doi": "10.1007/s12540-018-0184-6","mech_prop": {"temperature": 298,"yield_strength": null,"ultimate_strength": null,"elongation": null,"impact energy":null},"materials": {"mat_name": "40Fe-25Ni-15Cr-10Co-10V HEA","mat_type": "HEA","composition": [["Fe",40.0],["Ni",25.0],["Cr",15.0],["Co",10.0],["V",10.0]],"ratio_type": "at%"},"processing": {"proc_para": [{"type": "vacuum induction melting"},{"type": "homogenization","temperature": {"value": [1100],"unit": "°C"},"time": {"value": [6],"unit": "h"},"environment": "argon"},{"type": "water quenching"},{"type": "cold rolling","initial size": {"type": "thickness","value": [8.0],"unit": "mm"},"final size": {"type": "thickness","value": [1.5],"unit": "mm"},"reduction unit": "%","reduction value": [80.0]},{"type": "annealing","temperature": {"value": [900],"unit": "°C"},"time": {"value": [10],"unit": "min"},"atmosphere": "argon"},{"type": "water quenching"}],"surf_para": [],"ingot_desc": "","ingot_size": []},"testing": {"test_type": "tensile","test_tem": [298],"test_env": "","refrigerant": "","test_mac": "Instron 1361, USA","test_standard": "","load_ctrl": "strain","rate": [{"value": [0.001],"unit": "s-1"}],"spec_desc": "dog-bone","spec_shape": "rectangular","spec_size": [],"spec_standard": "","spec_dir": "parallel to the rolling direction","spec_notch":""}},{"doi": "10.1007/s12540-018-0184-6","mech_prop": {"temperature": 77,"yield_strength": null,"ultimate_strength": null,"elongation": null,"impact energy":null},"materials": {"mat_name": "40Fe-25Ni-15Cr-10Co-10V HEA","mat_type": "HEA","composition": [["Fe",40.0],["Ni",25.0],["Cr",15.0],["Co",10.0],["V",10.0]],"ratio_type": "at%"},"processing": {"proc_para": [{"type": "vacuum induction melting"},{"type": "homogenization","temperature": {"value": [1100],"unit": "°C"},"time": {"value": [6],"unit": "h"},"environment": "argon"},{"type": "water quenching"},{"type": "cold rolling","initial size": {"type": "thickness","value": [8.0],"unit": "mm"},"final size": {"type": "thickness","value": [1.5],"unit": "mm"},"reduction unit": "%","reduction value": [80.0]},{"type": "annealing","temperature": {"value": [900],"unit": "°C"},"time": {"value": [10],"unit": "min"},"atmosphere": "argon"},{"type": "water quenching"}],"surf_para": [],"ingot_desc": "","ingot_size": []},"testing": {"test_type": "tensile","test_tem": [77],"test_env": "","refrigerant": "","test_mac": "Instron 1361, USA","test_standard": "","load_ctrl": "strain","rate": [{"value": [0.001],"unit": "s-1"}],"spec_desc": "dog-bone","spec_shape": "rectangular","spec_size": [],"spec_standard": "","spec_dir": "parallel to the rolling direction","spec_notch":""}}]'
str3 ='[{"doi":"","mech_prop":{"temperature":,"yield_strength":,"ultimate_strength":,"elongation":},"materials":{"mat_name":"","mat_type":"HEA/MEA/Al-alloys/Fe-alloys/Ti-alloys/...","composition":[],"ratio_type":"at%/wt%"},"processing":{"proc_para":[],"surf_para":[],"ingot_desc":"rectangular/circular/...","ingot_size":[]},"testing":{"test_type":"tensile/compression/impact","test_tem":[],"test_env":"","refrigerant":"","test_mac":"","test_standard":"","load_ctrl":"strain/displacement/force/stress","rate":[{"value":[],"unit":""}],"spec_desc":"dog-bone/cylindrical/...","spec_shape":"rectangular/circular","spec_size":[长，宽，厚或者长度，直径],"spec_standard":"","spec_dir":"","spec_notch":"U/V/..."}},....]'
# Build a message list, including two examples
message0 = [
    {"role": "system", "content": "You are an expert in low-temperature alloy materials and are skilled at extracting key information from text. Based on the examples and text provided by the user, extract key data and facts and present the extracted information strictly in the JSON text structure of the examples."},
    {"role": "user", "content": text1},
    {"role": "assistant", "content": str1},
    {"role": "user", "content": text2},
    {"role": "assistant", "content": str2},
    {"role": "user", "content": "Now, following the formats of the two examples above, extract the low-temperature materials, compositions, related production and processing conditions, experimental conditions, and mechanical properties such as strength, fracture strain, etc., from the following list of text. Return the data in JSON format.Extract the following information from the text:"+ str3 +"Please strictly follow the JSON data format of the examples I provided to extract tensile/compression/impact test information, excluding fatigue test-related information. Convert temperature parameters to Kelvin (K), and if any numbers are in scientific notation (such as the rate value), please convert them to normal numbers.Please note that each dictionary in the list represents different material compositions, processing conditions, and experimental conditions corresponding to different mechanical property data. Each distinct material composition (materials) - processing condition (processing) - experimental condition (testing) pair should be stored as a separate dictionary (this is very important, and you must return all the data for different conditions). Do not return example data."},
]


for doi, art in doc_dict.items():
    

    try:
        text_content = art['content']
        table_content = art['tables']
        full = text_content + table_content

       
      
        msg = copy.deepcopy(message0)
        msg.append({"role": "user", "content": '{}'.format(full)})
        response = client.chat.completions.create(
            model='glm-4-0520',

            messages=msg,
            max_tokens=8100,
            stop=None,
            temperature=0.2,
        )

      
        result=response.choices[0].message.content

     
        data.append({
            "doi": doi,
            "extracted_info": result,
            'completion_tokens': response.usage.completion_tokens,
            'prompt_tokens': response.usage.prompt_tokens,
            'total_tokens': response.usage.total_tokens
        })
        f=open(docpath + 'extracted_info_1.json', 'w', encoding='utf-8')
        json.dump(data,f, indent=4)
        f.close()
        print(f"{doi}:done")
    except Exception as e:
        print(f"Error processing {doi}: {e}")





with open(docpath + 'extracted_info.json', 'w', encoding='utf-8') as f:
    json.dump(data, f, indent=4)
